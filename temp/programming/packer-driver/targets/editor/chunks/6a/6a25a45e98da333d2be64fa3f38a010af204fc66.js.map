{"version":3,"sources":["file:///Users/super_javan/cocoscreator/littleBeastFight3.6/assets/Battle/BattleLogic.ts"],"names":["FBGameLogic","EventMgr","ResMgr","ResType","LogicEvent","reslist","BaseLogic","init","Instance","addEventListen","ENTER_FBGAME","onStartEnter","bind","ENTER_HALL_FROM_GAMES","onBackHall","data","console","log","setTimeout","getInstance","releaseAllResByList","startLoadGame","list","UIMgr","clearWaiting","FBGameUIMgr","showLoading","resType","Map","set","ResType_Prefab","ResType_SpriteAtlas","ResType_AudioClip","ResType_SpriteFrame","preLoad","onLoadResourceProgress","onLoadResourceComplete","process","dispatchEvent","FBGameEventName","GAME_LOAD_PROGRESS","err","GAME_LOAD_COMPLETE","showFBGame","LogicManager","registerLogicTypes"],"mappings":";;;8EAKaA,W;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AALNC,MAAAA,Q;;AACEC,MAAAA,M,iBAAAA,M;AAAQC,MAAAA,O,iBAAAA,O;;AACRC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,O,iBAAAA,O;;;;;;;6BAEIL,W,GAAN,MAAMA,WAAN,SAA0BM,SAA1B,CAAoC;AAChCC,QAAAA,IAAI,GAAS;AAChB;AAAA;AAAA,oCAASC,QAAT,CAAkBC,cAAlB,CAAiC;AAAA;AAAA,wCAAWC,YAA5C,EAA0D,KAAKC,YAAL,CAAkBC,IAAlB,CAAuB,IAAvB,CAA1D,EAAwF,IAAxF;AACA;AAAA;AAAA,oCAASJ,QAAT,CAAkBC,cAAlB,CAAiC;AAAA;AAAA,wCAAWI,qBAA5C,EAAmE,KAAKC,UAAL,CAAgBF,IAAhB,CAAqB,IAArB,CAAnE,EAA+F,IAA/F;AACH,SAJsC,CAMvC;;;AACOE,QAAAA,UAAU,CAACC,IAAD,EAAuB;AACpC,gBAAMD,UAAN,CAAiBC,IAAjB;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AACAC,UAAAA,UAAU,CAAC,MAAM;AACb;AACA;AAEA;AACA;AAAA;AAAA,kCAAOC,WAAP,GAAqBC,mBAArB;AAAA;AAAA;AACH,WANS,CAAV;AAOH;;AAEiB,cAAZT,YAAY,CAACI,IAAD,EAAsC;AACpD,gBAAM,MAAMJ,YAAN,CAAmBI,IAAnB,CAAN,CADoD,CAEpD;;AACA,eAAKM,aAAL;AACH;AAED;AACJ;AACA;;;AACuB,cAAbA,aAAa,GAAG;AAClB,cAAIC,IAAI;AAAA;AAAA,gCAAR;AACA,gBAAMC,KAAK,CAACJ,WAAN,GAAoBK,YAApB,EAAN;AACA,gBAAMC,WAAW,CAACN,WAAZ,GAA0BO,WAA1B,EAAN;AACA,cAAIC,OAA8B,GAAG,IAAIC,GAAJ,EAArC;AACAD,UAAAA,OAAO,CAACE,GAAR,CAAY;AAAA;AAAA,kCAAQC,cAApB,EAAoC,IAApC;AACAH,UAAAA,OAAO,CAACE,GAAR,CAAY;AAAA;AAAA,kCAAQE,mBAApB,EAAyC,IAAzC;AACAJ,UAAAA,OAAO,CAACE,GAAR,CAAY;AAAA;AAAA,kCAAQG,iBAApB,EAAuC,IAAvC;AACAL,UAAAA,OAAO,CAACE,GAAR,CAAY;AAAA;AAAA,kCAAQI,mBAApB,EAAyC,IAAzC;AAEA;AAAA;AAAA,gCAAOd,WAAP,GAAqBe,OAArB,CAA6BZ,IAA7B,EAAmC,KAAKa,sBAAL,CAA4BvB,IAA5B,CAAiC,IAAjC,CAAnC,EAA2E,KAAKwB,sBAAL,CAA4BxB,IAA5B,CAAiC,IAAjC,CAA3E,EAAmHe,OAAnH;AACH,SAvCsC,CAyCvC;;;AACUQ,QAAAA,sBAAsB,CAACE,OAAD,EAAkB;AAC9CrB,UAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBoB,OAAtB,EAA+B,OAA/B;AACA;AAAA;AAAA,oCAAS7B,QAAT,CAAkB8B,aAAlB,CAAgCC,eAAe,CAACC,kBAAhD,EAAoEH,OAApE;AACH,SA7CsC,CA+CvC;;;AACUD,QAAAA,sBAAsB,CAACK,GAAD,EAAW;AACvC;AAAA;AAAA,oCAASjC,QAAT,CAAkB8B,aAAlB,CAAgCC,eAAe,CAACG,kBAAhD;AACAnB,UAAAA,KAAK,CAACJ,WAAN,GAAoBK,YAApB;AACAC,UAAAA,WAAW,CAACN,WAAZ,GAA0BwB,UAA1B;AACH;;AApDsC,O;;AAsD3CC,MAAAA,YAAY,CAACzB,WAAb,GAA2B0B,kBAA3B,CAA8C7C,WAA9C","sourcesContent":["import EventMgr from \"../Script/Base/EventMgr\";\nimport { ResMgr, ResType } from \"../Script/Base/ResMgr\";\nimport { LogicEvent, LogicEventData } from \"../Script/Games/LogicEvent\";\nimport { reslist } from \"./reslist\";\n\nexport class FBGameLogic extends BaseLogic {\n    public init(): void {\n        EventMgr.Instance.addEventListen(LogicEvent.ENTER_FBGAME, this.onStartEnter.bind(this), this);\n        EventMgr.Instance.addEventListen(LogicEvent.ENTER_HALL_FROM_GAMES, this.onBackHall.bind(this), this);\n    }\n\n    //从子游戏返回到大厅了\n    public onBackHall(data: LogicEventData) {\n        super.onBackHall(data);\n        console.log(\"返回大厅，需要释放资源\");\n        setTimeout(() => {\n            //清除消息注册\n            // FBGameNet.destory();\n\n            //释放对应bundle中的资源 如果是从\n            ResMgr.getInstance().releaseAllResByList(reslist);\n        });\n    }\n\n    async onStartEnter(data: LogicEventData): Promise<void> {\n        await super.onStartEnter(data);\n        // FBGameNet.getInstance().register();\n        this.startLoadGame();\n    }\n\n    /**\n     * @description: 开始加载游戏资源\n     */\n    async startLoadGame() {\n        let list = reslist;\n        await UIMgr.getInstance().clearWaiting();\n        await FBGameUIMgr.getInstance().showLoading();\n        let resType: Map<ResType, boolean> = new Map();\n        resType.set(ResType.ResType_Prefab, true);\n        resType.set(ResType.ResType_SpriteAtlas, true);\n        resType.set(ResType.ResType_AudioClip, true);\n        resType.set(ResType.ResType_SpriteFrame, true);\n\n        ResMgr.getInstance().preLoad(list, this.onLoadResourceProgress.bind(this), this.onLoadResourceComplete.bind(this), resType);\n    }\n\n    //加载资源进度\n    protected onLoadResourceProgress(process: number) {\n        console.log(\"游戏资源进度\", process, \"=====\");\n        EventMgr.Instance.dispatchEvent(FBGameEventName.GAME_LOAD_PROGRESS, process);\n    }\n\n    //加载资源完成\n    protected onLoadResourceComplete(err: any) {\n        EventMgr.Instance.dispatchEvent(FBGameEventName.GAME_LOAD_COMPLETE);\n        UIMgr.getInstance().clearWaiting();\n        FBGameUIMgr.getInstance().showFBGame();\n    }\n}\nLogicManager.getInstance().registerLogicTypes(FBGameLogic);"]}