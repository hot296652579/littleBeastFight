{"version":3,"sources":["file:///Users/super_javan/cocoscreator/littleBeastFight3.6/assets/Battle/Script/games/GameEngine.ts"],"names":["GameEngine","SitDownDTO","StartGameDTO","OperationNotifyDTO","MoveResultDTO","OpenResultDTO","EndGameDTO","ConfirmColorDTO","AiEngine","constructor","players","chairColors","cards","currCards","DARK_CARD","currChair","_aiEngine","enter","player","chair","assignChair","INVALID_CHAIR","sendSitDown","createAiPlayer","startGame","shuffle","Math","floor","random","MAX_CHAIR","sendStartGame","key","sitDown","userId","name","sendOpenResult","index","card","openResult","sendMoveResult","fromIndex","fromCard","toIndex","toCard","result","moveResult","sendOperationNotify","nextChair","operationNotify","sendEndGame","c","checkWin","k","parseInt","endGame","sendConfirmColor","color","confirmColor","open","openCardDTO","console","log","JSON","stringify","length","Object","keys","i","RED","BLUE","move","moveCardDTO","fromV","nextV","fromC","toC","NONE_CARD","indexOf","blueC","redC","forEach","v","sort","canMove","from","to","iRow","iCol","jRow","jCol","abs","MAX_CARD","DARK","NONE","INVALID_INDEX"],"mappings":"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","sourcesContent":["\nimport Player from \"./Player\";\nimport SitDownDTO from \"./dto/SitDownDTO\";\nimport StartGameDTO from \"./dto/StartGameDTO\";\nimport OpenCardDTO from \"./dto/OpenCardDTO\";\nimport OperationNotifyDTO from \"./dto/OperationNotifyDTO\";\nimport MoveCardDTO from \"./dto/MoveCardDTO\";\nimport MoveResultDTO from \"./dto/MoveResultDTO\";\nimport OpenResultDTO from \"./dto/OpenResultDTO\";\nimport EndGameDTO from \"./dto/EndGameDTO\";\nimport ConfirmColorDTO from \"./dto/ConfirmColorDTO\";\nimport FireKit from \"./fire/FireKit\";\nimport Config from \"./Config\";\nimport AiEngine from \"./AiEngine\";\n\n/**\n * 游戏引擎\n */\nexport default class GameEngine {\n\n    /**\n     * 最多牌数量\n     */\n    static MAX_CARD: number = 16;\n    /**\n     * 最大椅子个数\n     */\n    static MAX_CHAIR: number = 2;\n    /**\n     * 无效的牌\n     */\n    static NONE_CARD: number = 0xF0;\n    /**\n     * 未知的牌，未翻牌\n     */\n    static DARK_CARD: number = 0xE0;\n    /**\n     * 颜色\n     */\n    static BLUE: number = 0x00;\n    /**\n     * 红色\n     */\n    static RED: number = 0x01;\n    /**\n     * 未知牌颜色标识\n     */\n    static DARK: number = 0x0E;\n    /**\n     * 无效牌颜色标识\n     */\n    static NONE: number = 0x0F;\n    /**\n     * 无效的椅子\n     */\n    static INVALID_CHAIR: number = 0xFF;\n    /**\n     * 无效的位置\n     */\n    static INVALID_INDEX: number = 0xFF;\n    /**\n     * 当前游戏里玩家\n     */\n    private players: { [key: number]: Player } = {};\n    /**\n     * 椅子与颜色的对应关系\n     */\n    private chairColors: { [key: number]: number } = {};\n    /**\n     * 游戏动物棋牌\n     */\n    private cards: number[] = [\n        // 鼠    猫    狗    狼    豹    虎    狮    象\n        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, // 蓝色\n        0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17  // 红色\n    ];\n    /**\n     * 当前桌面的牌\n     */\n    private currCards: number[] = [\n        GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD,\n        GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD, GameEngine.DARK_CARD];\n    /**\n     * 当前操作的玩家 0 / 1\n     */\n    private currChair: number;\n    /**\n     * AI 引擎\n     */\n    private _aiEngine: AiEngine;\n\n    constructor() {\n        this._aiEngine = new AiEngine(this);    //初始化AI引擎\n    }\n\n    /**\n     * 玩家进入游戏\n     * @param player\n     */\n    enter(player: Player) {\n        let chair = this.assignChair();             // 分配椅子\n        if (chair != GameEngine.INVALID_CHAIR) {    // 分配成功并且通知玩家\n            this.players[chair] = player;\n            this.sendSitDown(chair, player);\n            if (this.assignChair() != GameEngine.INVALID_CHAIR) {    //如果还有空闲的椅子\n                this._aiEngine.createAiPlayer();\n            } else { // 坐满开局\n                this.startGame(); //游戏开始\n            }\n        }\n    }\n\n    /**\n     * 开始游戏\n     */\n    startGame() {\n        this.cards = this.shuffle();\n        // this.currChair = _.random(0, GameEngine.MAX_CHAIR - 1, false); // 随机生成第一个操作的椅子\n        this.currChair = Math.floor(Math.random() * GameEngine.MAX_CHAIR - 1);//随机生成第一个椅子\n        this.sendStartGame();\n    }\n\n    /**\n     * 发送开始游戏\n     */\n    private sendStartGame() {\n        for (let key in this.players) {\n            this.players[key].startGame(new StartGameDTO(this.currChair, this.currCards));\n        }\n    }\n\n    /**\n     * 给所有玩家发送玩家坐下的信息\n     * @param chair\n     * @param player\n     */\n    private sendSitDown(chair: number, player: Player) {\n        for (let key in this.players) {\n            this.players[key].sitDown(new SitDownDTO(player.userId, chair, player.name));\n        }\n    }\n\n    /**\n     * 发送显示牌\n     * @param chair\n     * @param index\n     * @param card\n     */\n    private sendOpenResult(chair: number, index: number, card: number) {\n        for (let key in this.players) {\n            this.players[key].openResult(new OpenResultDTO(chair, index, card));\n        }\n    }\n\n    /**\n     * 发送移动结果\n     * @param chair\n     * @param fromIndex\n     * @param fromCard\n     * @param toIndex\n     * @param toCard\n     * @param result\n     */\n    private sendMoveResult(chair: number, fromIndex: number, fromCard: number, toIndex: number, toCard: number, result: number) {\n        for (let key in this.players) {\n            this.players[key].moveResult(new MoveResultDTO(chair, fromIndex, fromCard, toIndex, toCard, result));\n        }\n    }\n\n    /**\n     * 发送玩家操作通知\n     */\n    private sendOperationNotify() {\n        this.currChair = this.nextChair();  // 获取下一个操作的椅子\n        for (let key in this.players) {\n            this.players[key].operationNotify(new OperationNotifyDTO(this.currChair));\n        }\n    }\n\n    /**\n     * 发送游戏结束信息\n     */\n    private sendEndGame() {\n        let c = this.checkWin();    // 胜利的颜色\n        let chair: number;\n        for (let k in this.chairColors) {\n            if (this.chairColors[k] == c) {\n                chair = parseInt(k);\n            }\n        }\n        for (let key in this.players) {\n            this.players[key].endGame(new EndGameDTO(chair, c));\n        }\n    }\n\n    /**\n     * 分配颜色\n     */\n    private sendConfirmColor(chair: number, color: number) {\n        for (let key in this.players) {\n            this.players[key].confirmColor(new ConfirmColorDTO(chair, color));\n        }\n    }\n\n    /**\n     * 开牌\n     * @param openCardDTO\n     */\n    open(openCardDTO: OpenCardDTO) {\n        console.log(\"OpenCard:\" + JSON.stringify(openCardDTO));\n        let chair = openCardDTO.chair;\n        let index = openCardDTO.index;\n        if (chair != this.currChair) {\n            console.log(\"无效操作.\");\n            return;\n        }\n        if (this.currCards[index] == GameEngine.DARK_CARD) {\n            let card = this.cards[index];\n            let length = Object.keys(this.chairColors).length\n            if (length == 0) {    //分配颜色\n                for (let i = 0; i < GameEngine.MAX_CHAIR; i++) {\n                    if (i == chair) {\n                        this.chairColors[chair] = (card >> 4);\n                        this.sendConfirmColor(chair, (card >> 4));\n                    } else {\n                        this.chairColors[i] = GameEngine.RED ? GameEngine.BLUE : GameEngine.RED;\n                        this.sendConfirmColor(i, (card >> 4) == GameEngine.RED ? GameEngine.BLUE : GameEngine.RED);\n                    }\n                }\n            }\n            this.currCards[index] = card;\n            this.sendOpenResult(chair, index, this.currCards[index]);\n            if (this.checkWin() != -1) {\n                this.sendEndGame();\n            } else {\n                this.sendOperationNotify();\n            }\n        }\n    }\n\n    /**\n     * 移动牌\n     * @param moveCardDTO\n     */\n    move(moveCardDTO: MoveCardDTO) {\n        console.log(\"MoveCard:\" + JSON.stringify(moveCardDTO));\n        let fromIndex = moveCardDTO.fromIndex;\n        let toIndex = moveCardDTO.toIndex;\n        let fromCard = this.currCards[fromIndex];   // 当前位置的牌\n        let toCard = this.currCards[toIndex];   // 下一个位置的牌\n        let fromV = (fromCard & 0x0F);\n        let nextV = (toCard & 0x0F);\n        let fromC = fromCard >> 4;\n        let toC = toCard >> 4;\n        if (fromC > 1 || toC == (GameEngine.DARK_CARD >> 4)) {  // 当前位置不是正常的牌，或者下一个位置是未翻开的牌\n            console.log(\"异常操作\");\n            return;\n        }\n        this.currCards[fromIndex] = GameEngine.NONE_CARD;           // 当前位置变成空\n        if (toC == (GameEngine.NONE_CARD >> 4)) {                   // 下个位置是空位\n            this.currCards[toIndex] = fromCard;\n        } else { // 非空未知\n            if (fromV > nextV) {\n                if (fromV == 7 && nextV == 0) { // 大象 和 老鼠\n                    this.currCards[toIndex] = toCard;\n                } else {\n                    this.currCards[toIndex] = fromCard;\n                }\n            }\n            if (fromV == nextV) {\n                this.currCards[toIndex] = GameEngine.NONE_CARD;\n            }\n            if (fromV < nextV) {\n                if (fromV == 0 && nextV == 7) { // 老鼠 和 大象\n                    this.currCards[toIndex] = fromCard;\n                } else {\n                    this.currCards[toIndex] = toCard;\n                }\n            }\n        }\n        let result: number;\n        if (this.currCards[toIndex] == GameEngine.NONE_CARD) {\n            result = 0;\n        } else if (this.currCards[toIndex] == fromCard) {\n            result = 1;\n        } else {\n            result = -1;\n        }\n        this.sendMoveResult(moveCardDTO.chair, fromIndex, this.currCards[fromIndex], toIndex, this.currCards[toIndex], result);\n        if (this.checkWin() != -1) {\n            this.sendEndGame();\n        } else {\n            this.sendOperationNotify();\n        }\n    }\n\n    /**\n     * 校验游戏是否结束\n     */\n    private checkWin(): number {\n        if (this.currCards.indexOf(GameEngine.DARK_CARD) == -1) {\n            let blueC = 0;\n            let redC = 0;\n            this.currCards.forEach((v) => {\n                if (v != GameEngine.NONE_CARD) {\n                    if ((v >> 4) == 0) {\n                        blueC++;\n                    } else {\n                        redC++;\n                    }\n                }\n            });\n            if (blueC == 0) {\n                return GameEngine.RED; // 红赢\n            }\n            if (redC == 0) {\n                return GameEngine.BLUE; // 蓝赢\n            }\n        }\n        return -1;\n    }\n\n    /**\n     *  洗牌，随机数组\n     */\n    private shuffle(): number[] {\n        this.cards.sort(function () {\n            return Math.random() - 0.5\n        })\n        return this.cards;\n    }\n\n    /**\n     * 分配椅子\n     */\n    private assignChair(): number {\n        for (let i = 0; i < GameEngine.MAX_CHAIR; i++) {\n            if (this.players[i] == null) {\n                return i;\n            }\n        }\n        return GameEngine.INVALID_CHAIR;\n    }\n\n    /**\n     * 获取下一个操作的玩家\n     */\n    private nextChair(): number {\n        return (this.currChair + 1) % GameEngine.MAX_CHAIR;\n    }\n\n\n    /**\n     * 是否可以移动\n     * @param from  当前\n     * @param to    目标\n     * @param cards 牌\n     */\n    public canMove(from: number, to: number, cards: number[]): boolean {\n        let iRow = Math.floor(from / 4);\n        let iCol = from % 4;\n        let jRow = Math.floor(to / 4);\n        let jCol = to % 4;\n        if (cards[from] == GameEngine.DARK_CARD\n            || cards[to] == GameEngine.DARK_CARD\n            || (cards[from] >> 4) == (cards[to] >> 4)) {\n            return false;\n        }\n        return (iRow == jRow && Math.abs(iCol - jCol) == 1) || (iCol == jCol && Math.abs(iRow - jRow) == 1);\n    }\n\n}\n"]}