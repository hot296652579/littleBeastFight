{"version":3,"sources":["file:///Users/super_javan/cocoscreator/littleBeastFight3.6/assets/Battle/BattleLogic.ts"],"names":["BattleLogic","UILobbyMgr","EventMgr","LogicManager","ResMgr","ResType","BaseLogic","FBGameEventName","LogicEvent","reslist","UIBattleMgr","init","Instance","addEventListen","ENTER_FBGAME","onStartEnter","bind","ENTER_HALL_FROM_GAMES","onBackHall","data","console","log","setTimeout","getInstance","releaseAllResByList","startLoadGame","list","clearWaiting","showLoading","resType","Map","set","ResType_Prefab","ResType_SpriteAtlas","ResType_AudioClip","ResType_SpriteFrame","preLoad","onLoadResourceProgress","onLoadResourceComplete","process","emit","GAME_LOAD_PROGRESS","err","GAME_LOAD_COMPLETE","showFBGame","registerLogicTypes"],"mappings":"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","sourcesContent":["import { UILobbyMgr } from \"../Lobby/UILobbyMgr\";\nimport EventMgr from \"../Script/Base/EventMgr\";\nimport { LogicManager } from \"../Script/Base/LogicManager\";\nimport { ResMgr, ResType } from \"../Script/Base/ResMgr\";\nimport { BaseLogic } from \"../Script/Games/BaseLogic\";\nimport { FBGameEventName, LogicEvent, LogicEventData } from \"../Script/Games/LogicEvent\";\nimport { reslist } from \"./reslist\";\nimport { UIBattleMgr } from \"./UIBattleMgr\";\n\nexport class BattleLogic extends BaseLogic {\n    public init(): void {\n        EventMgr.Instance.addEventListen(LogicEvent.ENTER_FBGAME, this.onStartEnter.bind(this), this);\n        EventMgr.Instance.addEventListen(LogicEvent.ENTER_HALL_FROM_GAMES, this.onBackHall.bind(this), this);\n    }\n\n    //从子游戏返回到大厅了\n    public onBackHall(data: LogicEventData) {\n        super.onBackHall(data);\n        console.log(\"返回大厅，需要释放资源\");\n        setTimeout(() => {\n            //清除消息注册\n            // FBGameNet.destory();\n\n            //释放对应bundle中的资源 如果是从\n            ResMgr.getInstance().releaseAllResByList(reslist);\n        });\n    }\n\n    async onStartEnter(data: LogicEventData): Promise<void> {\n        await super.onStartEnter(data);\n        // FBGameNet.getInstance().register();\n        this.startLoadGame();\n    }\n\n    /**\n     * @description: 开始加载游戏资源\n     */\n    async startLoadGame() {\n        let list = reslist;\n        await UILobbyMgr.Instance().clearWaiting();\n        await UIBattleMgr.Instance().showLoading();\n        let resType: Map<ResType, boolean> = new Map();\n        resType.set(ResType.ResType_Prefab, true);\n        resType.set(ResType.ResType_SpriteAtlas, true);\n        resType.set(ResType.ResType_AudioClip, true);\n        resType.set(ResType.ResType_SpriteFrame, true);\n\n        ResMgr.getInstance().preLoad(list, this.onLoadResourceProgress.bind(this), this.onLoadResourceComplete.bind(this), resType);\n    }\n\n    //加载资源进度\n    protected onLoadResourceProgress(process: number) {\n        console.log(\"游戏资源进度\", process, \"=====\");\n        EventMgr.Instance.emit(FBGameEventName.GAME_LOAD_PROGRESS, process);\n    }\n\n    //加载资源完成\n    protected onLoadResourceComplete(err: any) {\n        EventMgr.Instance.emit(FBGameEventName.GAME_LOAD_COMPLETE);\n        UILobbyMgr.Instance().clearWaiting();\n        UIBattleMgr.Instance().showFBGame();\n    }\n}\nLogicManager.Instance().registerLogicTypes(BattleLogic);"]}