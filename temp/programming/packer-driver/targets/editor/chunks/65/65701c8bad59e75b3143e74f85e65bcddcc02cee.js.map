{"version":3,"sources":["file:///Users/super_javan/cocoscreator/littleBeastFight3.6/assets/Script/UIFrame/UIMgr.ts"],"names":["UIManager","director","instantiate","js","NodePool","Size","Tween","tween","view","warn","Widget","UITransform","UIOpacity","ResMgr","FormType","ModalOpacity","PriorityStake","ModalMgr","UIScreen","UIWindow","ndScreen","ndWin","allForms","createMap","screensStack","loadingForms","winArr","winMasks","screenMasks","waitNodePool","maskNodePool","getInstance","instance","on","onWinSizeChged","uiscreens","getElements","k","length","console","log","node","getComponent","updateAlignment","init","checkFormShowing","prefabPath","com","active","checkFormLoading","getMaskNode","size","get","openScreen","params","undefined","pb","getPrefabByPath","error","isOnleyEngross","getSize","getTopElement","closeSelf","isEngross","maskNode","mask","addChild","setContentSize","screen","width","height","fid","onShow","showEffect","all","push","openWin","loadForm","modalType","opacity","OpacityZero","getFrameSize","arr","getModelTypeComs","checkModalWinAndPopUp","closeForm","path","split","formType","FormType_Screen","exitToScreen","FormType_Fixed","FormType_Popup","FormType_Float","FormType_Win","exitToWin","FormType_Loading","FormType_Bubble","tcom","pop","nextCom","reShow","onHide","hideEffect","destroy","destoryForm","reBackMaskNode","tIdx","splice","maskPath","t","getHideEffectTime","stopAllByTarget","to","easing","call","start","put","destory","off"],"mappings":"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","sourcesContent":["import { director, instantiate, js, NodePool, Node, Size, Tween, tween, view, warn, Widget, UITransform, UIOpacity } from \"cc\";\nimport { ResMgr } from \"../Base/ResMgr\";\nimport { FormType, ModalOpacity } from \"../Config/SysDefine\";\nimport { PriorityStake } from \"../Utils/PriorityStake\";\nimport { ModalMgr } from \"./ModalMgr\";\n\n// import { ModalMgr } from \"./ModalMgr\";\nimport { UIBase } from \"./UIBase\";\nimport { UILoading, UIScreen, UIWindow } from \"./UIFrom\";\n\nexport class UIManager {\n    //全屏显示的ui挂载节点\n    private ndScreen: Node | null = null;\n    //能够拦截float的win\n    private ndWin: Node | null = null;\n\n    //所有显示的窗体\n    private allForms: { [key: string]: UIBase } = js.createMap();\n    //存储screen\n    private screensStack: PriorityStake<UIScreen> = new PriorityStake<UIScreen>();\n    private loadingForms: { [key: string]: boolean } = js.createMap();\n    private winArr: UIWindow[] = [];\n\n    //win类型的masks\n    private winMasks: { [key: string]: Node } = js.createMap();\n    //screen类型的masks\n    private screenMasks: { [key: string]: Node } = js.createMap();\n\n\n    private static instance: UIManager;\n    public static getInstance(): UIManager {\n        if (this.instance == null) {\n            this.instance = new UIManager();\n            director.on(\"winsizechanged\", this.instance.onWinSizeChged, this.instance);\n        }\n        return this.instance;\n    }\n\n    onWinSizeChged() {\n\n        let uiscreens = this.screensStack.getElements();\n        for (let k = 0; k < uiscreens.length; k++) {\n            console.log(\"窗口变化，要重新刷新一下======\");\n            uiscreens[k].node.getComponent(Widget)!.updateAlignment();\n        }\n    }\n\n    //初始化\n    public init(ndScreen: Node,\n        ndWin: Node): void {\n        this.ndScreen = ndScreen;\n        this.ndWin = ndWin;\n    }\n\n    //判断一个界面是否正在显示\n    public checkFormShowing(prefabPath: string): boolean {\n        let com = this.allForms[prefabPath];\n        if (!com) {\n            return false;\n        }\n        return com.node.active;\n    }\n    public checkFormLoading(prefabPath: string) {\n        let com = this.loadingForms[prefabPath];\n        return !!com;\n    }\n\n    private waitNodePool: NodePool = new NodePool();\n    private maskNodePool: NodePool = new NodePool();\n    private getMaskNode() {\n        if (this.maskNodePool.size() > 0) {\n            return this.maskNodePool.get();\n        }\n        return null\n    }\n\n    //打开一个screen\n    public async openScreen(prefabPath: string, ...params: any): Promise<UIScreen | null> {\n        console.log(`打开openScene--${prefabPath}`);\n        if (prefabPath == null || prefabPath == undefined || prefabPath.length <= 0) {\n            warn(`${prefabPath}，参数错误`);\n            return null;\n        }\n        //当前窗体正在显示\n        if (this.checkFormShowing(prefabPath)) {\n            warn(`${prefabPath}窗体正在显示中`);\n            return null;\n        }\n        if (this.checkFormLoading(prefabPath)) {\n            warn(`${prefabPath}正在加载中`);\n            return null;\n        }\n        this.loadingForms[prefabPath] = true;\n        let pb = ResMgr.getInstance().getPrefabByPath(prefabPath);\n\n        if (pb == null) {\n            console.error(\"兼容模式 需要 去健在窗体\")\n            // pb = await ResMgr.getInstance().loadForm(prefabPath)!;\n        }\n\n        if (pb == null) {\n            warn(`${prefabPath}窗体加载错误!`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        let node = instantiate(pb!);\n        let com = node.getComponent(UIScreen);\n        if (com == null) {\n            warn(`${prefabPath}没有绑定UIScreen组件`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n\n        if (com.isOnleyEngross) {\n            //关闭掉所有的screen\n            console.log(\"关闭所有的screeen\", this.screensStack.getSize(), \"==========\");\n            while (this.screensStack.getSize() > 0) {\n                await this.screensStack.getTopElement()!.closeSelf();\n            }\n        } else if (com.isEngross) {\n            // while (this.screensStack.getSize() > 0) {\n            //     await this.screensStack.getTopElement()!.closeSelf();\n            // }\n        }\n\n        //给screen增加屏蔽层\n        console.log(\"需要加屏蔽层========\");\n        let maskNode = this.getMaskNode();\n        if (maskNode == null) {\n            let mask = ResMgr.getInstance().getPrefabByPath(\"Lobby/Prefabs/UIMask\");\n            if (mask != null) {\n                maskNode = instantiate(mask!);\n            }\n        }\n        if (maskNode != null) {\n            //在首次加载的时候会有问题。这个地方需要优化一下\n            this.ndScreen!.addChild(maskNode!);\n            maskNode.getComponent(UITransform).setContentSize(new Size(screen.width, screen.height))\n            this.screenMasks[prefabPath] = maskNode!;\n        }\n\n        this.allForms[prefabPath] = com;\n        com.fid = prefabPath;\n        this.ndScreen!.addChild(node);\n\n        com.onShow(...params);\n        await com.showEffect();\n        if (!com.isEngross) {\n            //不独占 将其他screen active 设置为false\n            let all = this.screensStack.getElements();\n            for (let k = 0; k < all.length; k++) {\n                all[k].node.active = false;\n            }\n        }\n        //将对象保存到stack中\n        this.screensStack.push(com);\n        console.log('保存场景的堆栈数量 : !!!!!!' + this.screensStack.getSize());\n        delete this.loadingForms[prefabPath]\n        return com\n    }\n\n    //打开一个窗口\n    public async openWin(prefabPath: string, ...params: any): Promise<UIWindow | null> {\n        console.log(`打开openWin--${prefabPath}`);\n        if (prefabPath == null || prefabPath == undefined || prefabPath.length <= 0) {\n            warn(`${prefabPath}Win节点不存在`);\n            return null;\n        }\n        if (this.checkFormShowing(prefabPath)) {\n            warn(`${prefabPath}win节点正在显示中`);\n            return null;\n        }\n        if (this.checkFormLoading(prefabPath)) {\n            warn(`${prefabPath}win节点正在打开...`)\n            return null;\n        }\n        this.loadingForms[prefabPath] = true;\n        let pb = ResMgr.getInstance().getPrefabByPath(prefabPath);\n        //await this.waitFormsecond();\n        //兼容一下，暂时这么写。捕鱼的结构需要调整一下  这里要干掉否则 隐藏bug\n        if (pb == null) {\n            console.error(`${prefabPath}不存在使用了兼容模式`);\n            pb = await ResMgr.getInstance().loadForm(prefabPath);\n        }\n        if (pb == null) {\n            console.error(`${prefabPath}win节点加载失败`);\n            //如果加载失败了，则需要将节点从\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        let node = instantiate(pb);\n        let com = node.getComponent(UIWindow);\n        if (com == null) {\n            warn(`${prefabPath}win加载没有绑定到UIWindow组件上`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        if (com.modalType.opacity >= ModalOpacity.OpacityZero) {\n            console.log(\"开始获取屏蔽层的东西\");\n            let maskNode = this.getMaskNode();\n            if (maskNode == null) {\n                //有屏蔽层\n                let mask = ResMgr.getInstance().getPrefabByPath(\"Lobby/Prefabs/UIMask\");\n                maskNode = instantiate(mask!);\n            }\n            this.ndWin!.addChild(maskNode);\n            maskNode.getComponent(UITransform).setContentSize(new Size(view.getFrameSize().width, view.getFrameSize().height));\n            this.winMasks[prefabPath] = maskNode;\n        }\n        com.fid = prefabPath;\n        this.ndWin!.addChild(node);\n        this.winArr.push(com);\n        this.allForms[prefabPath] = com;\n        com.onShow(...params);\n        if (com.modalType.opacity >= ModalOpacity.OpacityZero) {\n            let arr: UIBase[] = this.getModelTypeComs();\n            ModalMgr.getInstance().checkModalWinAndPopUp(arr, this.winMasks, true);\n        }\n        delete this.loadingForms[prefabPath];\n        com.showEffect();\n\n        return com;\n    }\n\n    //动态计算需要遮罩的win和popups\n    //对于popup来说，层级越高，越在上\n    public getModelTypeComs(): UIBase[] {\n        let arr: UIBase[] = [];\n        for (let k = 0; k < this.winArr.length; k++) {\n            arr.push(this.winArr[k]);\n        }\n        return arr;\n    }\n\n    /**\n     * 关闭一个UIForm\n     * @prefabPath\n     */\n    public async closeForm(prefabPath: string): Promise<boolean> {\n        console.log(\"closeForm关闭\", prefabPath);\n        if (!prefabPath || prefabPath.length <= 0) {\n            warn(`${prefabPath}`, \"参数错误\");\n            return false;\n        }\n        let path = prefabPath.split(\"_\")[0];\n        let com = this.allForms[prefabPath];\n        if (!com && path.length == prefabPath.length) {\n            console.log(\"closeForm中的com不存在\");\n            return false;\n        }\n        // if(com == null && path.length != prefabPath.length){\n        //     for(let i = 0;i<this.bubbleMap.get(path).length;i++){\n        //         if(this.bubbleMap.get(path)[i].fid == prefabPath){\n        //             com = this.bubbleMap.get(path)[i];\n        //             break;\n        //         }\n        //     }\n        // }\n        if (!com) {\n            console.log(\"closeForm中的com不存在\");\n            return false;\n        }\n        switch (com.formType) {\n            case FormType.FormType_Screen:\n                await this.exitToScreen(prefabPath);\n                break;\n            case FormType.FormType_Fixed:\n                // await this.exitToFixed(prefabPath);\n                break;\n            case FormType.FormType_Popup:\n                // await this.exitToPopup(prefabPath);\n                break;\n            case FormType.FormType_Float:\n                // await this.exitToFloat(prefabPath);\n                break;\n            case FormType.FormType_Win:\n                await this.exitToWin(prefabPath);\n                break;\n            case FormType.FormType_Loading:\n                // await this.exitToLoading(prefabPath);\n                break;\n            case FormType.FormType_Bubble:\n                // await this.exitToBubble(prefabPath);\n                break;\n        }\n        return true;\n    }\n\n    /**\n     * screen退出\n     * @param prefabPath \n     * @returns \n     */\n    private async exitToScreen(prefabPath: string) {\n        console.log(`${prefabPath}exitToScreen`);\n        let com = this.allForms[prefabPath];\n        if (!com) {\n            return false;\n        }\n        //screen的退出必须是按照栈退出\n        let tcom = this.screensStack.pop();\n        if (tcom != com) {\n            warn(`${prefabPath}screen没有按顺序退出`);\n            return;\n        }\n        let nextCom = this.screensStack.getTopElement();\n        if (nextCom != null) {\n            nextCom.node.active = true;\n            //界面重新被激活\n            nextCom.reShow();\n        }\n        com.onHide();\n        //如果不是独占 （这里其实不用判断是否是独占，只要判定还有screen就显示出来就可以了）\n        await com.hideEffect();\n        //节点需要从父节点移除\n        com.node.destroy();\n        //com.node.removeFromParent();\n        ResMgr.getInstance().destoryForm(prefabPath);\n        delete this.allForms[prefabPath];\n        console.log(prefabPath, \"exittoscreen 成功\");\n        let maskNode = this.screenMasks[prefabPath];\n        if (maskNode != null && maskNode != undefined) {\n            if (!this.reBackMaskNode(maskNode)) {\n                maskNode.destroy();\n                ResMgr.getInstance().destoryForm(\"Lobby/Prefabs/UIMask\");\n            }\n            delete this.screenMasks[prefabPath];\n        }\n    }\n\n    /**\n     * @description:退出窗口 \n     * @param {string} prefabPath\n     */\n    private async exitToWin(prefabPath: string) {\n        let com: UIWindow | null = null;\n        let tIdx: number = -1;\n        if (this.winArr.length > 0) {\n            for (let k = 0; k < this.winArr.length; k++) {\n                if (this.winArr[k].fid == prefabPath) {\n                    tIdx = k;\n                    com = this.winArr[k];\n                    break;\n                }\n            }\n        }\n        if (tIdx >= 0 && tIdx < this.winArr.length) {\n            this.winArr.splice(tIdx, 1);\n            com!.onHide();\n            let maskPath = com!.fid;\n            let maskNode = this.winMasks[maskPath];\n            if (maskNode) {\n                let t = com!.getHideEffectTime();\n                //消失要有消失动画\n                Tween.stopAllByTarget(maskNode);\n                let opacity = maskNode.getComponent(UIOpacity).opacity\n                tween<UIOpacity>(maskNode.getComponent(UIOpacity))\n                    .to(t, { opacity: 0 }, { easing: 'linear' })\n                    // 当前面的动作都执行完毕后才会调用这个回调函数\n                    .call(() => {\n                        if (!this.reBackMaskNode(maskNode)) {\n                            maskNode.destroy();\n                            ResMgr.getInstance().destoryForm(\"Lobby/Prefabs/UIMask\");\n                        }\n                    })\n                    .start()\n            }\n            delete this.winMasks[maskPath];\n            let arr: UIBase[] = this.getModelTypeComs();\n            ModalMgr.getInstance().checkModalWinAndPopUp(arr, this.winMasks, false);\n            await com!.hideEffect();\n            com!.node.destroy();\n            ResMgr.getInstance().destoryForm(prefabPath);\n        }\n        delete this.allForms[prefabPath];\n    }\n    private reBackMaskNode(node: Node): boolean {\n        if (this.maskNodePool.size() >= 10) {\n            return false;\n        }\n        this.maskNodePool.put(node);\n        return true;\n    }\n\n    public static destory() {\n        this.instance = null!;\n        director.off(\"winsizechanged\")\n    }\n}"]}