{"version":3,"sources":["file:///Users/super_javan/cocoscreator/littleBeastFight3.6/assets/Script/UIFrame/UIMgr.ts"],"names":["UIManager","director","js","ResMgr","PriorityStake","FormType","ModalOpacity","ModalMgr","UIScreen","UIWindow","ndScreen","ndFixed","ndPopUp","ndFloat","ndWin","ndLoading","ndNode3d","ndUI2dOn3d","ndBubble","ndBlock","allForms","createMap","screensStack","loadingForms","winArr","popupsArr","winMasks","screenMasks","waitNodePool","NodePool","maskNodePool","getInstance","instance","on","onWinSizeChged","uiscreens","getElements","k","length","console","log","node","getComponent","Widget","updateAlignment","init","nd2dOn3d","checkFormShowing","prefabPath","com","active","checkFormLoading","getMaskNode","size","maskNode","get","openScreen","undefined","warn","pb","getPrefabByPath","error","loadForm","instantiate","isOnleyEngross","getSize","getTopElement","closeSelf","isEngross","is3d","mask","addChild","setContentSize","Size","screen","width","height","key","fid","params","onShow","showEffect","all","push","openWin","modalType","opacity","OpacityZero","view","getFrameSize","arr","getModelTypeComs","checkModalWinAndPopUp","reSortPopup","popup","tIdx","getSiblingIndex","maxIdx","bigger","setSiblingIndex","openWait","getWaitNode","closeWaiting","splice","onHide","maskPath","t","getHideEffectTime","Tween","stopAllByTarget","tween","to","easing","call","reBackMaskNode","destroy","destoryForm","start","hideEffect","reBackWaitNode","put","closeForm","path","split","formType","FormType_Screen","exitToScreen","FormType_Fixed","FormType_Popup","FormType_Float","FormType_Win","exitToWin","FormType_Loading","FormType_Bubble","tcom","pop","nextCom","reShow","destory","off"],"mappings":"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","sourcesContent":["import { director, js } from \"cc\";\nimport { ResMgr } from \"../BaseManager/ResMgr\";\nimport { PriorityStake } from \"../utils/PriorityStack\";\nimport { FormType, ModalOpacity } from \"./config/SysDefine\";\nimport { ModalMgr } from \"./ModalMgr\";\nimport { UIBase } from \"./UIBase\";\nimport { UIPopup, UIScreen, UIWindow } from \"./UIForm\";\n\nexport class UIManager {\n    //全屏显示的ui挂载节点\n    private ndScreen: Node = null;\n    //固定ui的挂载节点\n    private ndFixed: Node = null;\n    //弹出窗体的挂载节点\n    private ndPopUp: Node = null;\n    //浮动窗体\n    private ndFloat: Node = null;\n    //能够拦截float的win\n    private ndWin: Node = null;\n    //loading窗体\n    private ndLoading: Node = null;\n\n    private ndNode3d: Node = null;\n    public ndUI2dOn3d: Node = null;\n    //气泡\n    private ndBubble: Node = null;\n    //全局屏蔽层\n    private ndBlock: Node = null;\n\n    //所有显示的窗体\n    private allForms: { [key: string]: UIBase } = js.createMap();\n    //存储screen\n    private screensStack: PriorityStake<UIScreen> = new PriorityStake<UIScreen>();\n    private loadingForms: { [key: string]: boolean } = js.createMap();\n    private winArr: UIWindow[] = [];\n    //能够排序的一个popup array\n    private popupsArr: UIPopup[] = [];\n    //win类型的masks\n    private winMasks: { [key: string]: Node } = js.createMap();\n    //气泡的数据 delete bubbleMap[fid];\n    //气泡需要是按照 数组形式来的 string:prefabName UIBubble[] 是组件本身\n    // private bubbleMap:Map<string,UIBubble[]> = new Map<string,UIBubble[]>;\n\n    //screen类型的masks\n    private screenMasks: { [key: string]: Node } = js.createMap();\n\n\n    private static instance: UIManager;\n    public static getInstance(): UIManager {\n        if (this.instance == null) {\n            this.instance = new UIManager();\n            director.on(\"winsizechanged\", this.instance.onWinSizeChged, this.instance);\n        }\n        return this.instance;\n    }\n\n    onWinSizeChged() {\n\n        let uiscreens = this.screensStack.getElements();\n        for (let k = 0; k < uiscreens.length; k++) {\n            console.log(\"窗口变化，要重新刷新一下======\");\n            uiscreens[k].node.getComponent(Widget)!.updateAlignment();\n        }\n    }\n\n    //初始化\n    public init(ndScreen: Node,\n        ndFixed: Node,\n        ndPopUp: Node,\n        ndFloat: Node,\n        ndWin: Node,\n        ndLoading: Node,\n        ndNode3d: Node,\n        nd2dOn3d: Node,\n        ndBubble: Node,\n        ndBlock: Node): void {\n        this.ndScreen = ndScreen;\n        this.ndFixed = ndFixed;\n        this.ndPopUp = ndPopUp;\n        this.ndFloat = ndFloat;\n        this.ndWin = ndWin;\n        this.ndLoading = ndLoading;\n        this.ndNode3d = ndNode3d;\n        this.ndUI2dOn3d = nd2dOn3d;\n        this.ndBubble = ndBubble;\n        this.ndBlock = ndBlock;\n    }\n\n    //判断一个界面是否正在显示\n    public checkFormShowing(prefabPath: string): boolean {\n        let com = this.allForms[prefabPath];\n        if (!com) {\n            return false;\n        }\n        return com.node.active;\n    }\n    public checkFormLoading(prefabPath: string) {\n        let com = this.loadingForms[prefabPath];\n        return !!com;\n    }\n\n    private waitNodePool: NodePool = new NodePool();\n    private maskNodePool: NodePool = new NodePool();\n    private getMaskNode(): Node | null {\n        if (this.maskNodePool.size() > 0) {\n            let maskNode = this.maskNodePool.get();\n            return maskNode;\n        }\n        return null;\n    }\n\n    //打开一个screen\n    public async openScreen(prefabPath: string, ...params: any): Promise<UIScreen | null> {\n        console.log(`打开openScene--${prefabPath}`);\n        if (prefabPath == null || prefabPath == undefined || prefabPath.length <= 0) {\n            warn(`${prefabPath}，参数错误`);\n            return null;\n        }\n        //当前窗体正在显示\n        if (this.checkFormShowing(prefabPath)) {\n            warn(`${prefabPath}窗体正在显示中`);\n            return null;\n        }\n        if (this.checkFormLoading(prefabPath)) {\n            warn(`${prefabPath}正在加载中`);\n            return null;\n        }\n        this.loadingForms[prefabPath] = true;\n        let pb = ResMgr.getInstance().getPrefabByPath(prefabPath);\n\n        if (pb == null) {\n            console.error(\"兼容模式 需要 去健在窗体\")\n            pb = await ResMgr.getInstance().loadForm(prefabPath)!;\n        }\n\n        if (pb == null) {\n            warn(`${prefabPath}窗体加载错误!`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        let node = instantiate(pb!);\n        let com = node.getComponent(UIScreen);\n        if (com == null) {\n            warn(`${prefabPath}没有绑定UIScreen组件`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n\n        if (com.isOnleyEngross) {\n            //关闭掉所有的screen\n            console.log(\"关闭所有的screeen\", this.screensStack.getSize(), \"==========\");\n            while (this.screensStack.getSize() > 0) {\n                await this.screensStack.getTopElement()!.closeSelf();\n            }\n        } else if (com.isEngross) {\n            while (this.screensStack.getSize() > 0) {\n                await this.screensStack.getTopElement()!.closeSelf();\n            }\n        }\n\n        //给screen增加屏蔽层\n        if (!com.is3d) {\n            console.log(\"需要加屏蔽层========\");\n            let maskNode = this.getMaskNode();\n            if (maskNode == null) {\n                let mask = ResMgr.getInstance().getPrefabByPath(\"Lobby/Prefabs/UIMask\");\n                if (mask != null) {\n                    maskNode = instantiate(mask!);\n                }\n            }\n            if (maskNode != null) {\n                //在首次加载的时候会有问题。这个地方需要优化一下\n                this.ndScreen!.addChild(maskNode!);\n                maskNode!.setContentSize(new Size(screen.width, screen.height));\n                this.screenMasks[prefabPath] = maskNode!;\n            }\n        } else {\n            console.log(\"当前为3D场景不需要加屏蔽层\");\n            for (let key in this.screenMasks) {\n                this.screenMasks[key].active = false;\n            }\n        }\n\n        this.allForms[prefabPath] = com;\n        com.fid = prefabPath;\n        if (com.is3d) {\n            this.ndNode3d!.addChild(node);\n        } else {\n            this.ndScreen!.addChild(node);\n        }\n\n        com.onShow(...params);\n        await com.showEffect();\n        if (!com.isEngross) {\n            //不独占 将其他screen active 设置为false\n            let all = this.screensStack.getElements();\n            for (let k = 0; k < all.length; k++) {\n                all[k].node.active = false;\n            }\n        }\n        //将对象保存到stack中\n        this.screensStack.push(com);\n        console.log('保存场景的堆栈数量 : !!!!!!' + this.screensStack.getSize());\n        delete this.loadingForms[prefabPath]\n        return com\n    }\n    //打开一个窗口\n    public async openWin(prefabPath: string, ...params: any): Promise<UIWindow | null> {\n        console.log(`打开openWin--${prefabPath}`);\n        if (prefabPath == null || prefabPath == undefined || prefabPath.length <= 0) {\n            warn(`${prefabPath}Win节点不存在`);\n            return null;\n        }\n        if (this.checkFormShowing(prefabPath)) {\n            warn(`${prefabPath}win节点正在显示中`);\n            return null;\n        }\n        if (this.checkFormLoading(prefabPath)) {\n            warn(`${prefabPath}win节点正在打开...`)\n            return null;\n        }\n        this.loadingForms[prefabPath] = true;\n        let pb = ResMgr.getInstance().getPrefabByPath(prefabPath);\n        //await this.waitFormsecond();\n        //兼容一下，暂时这么写。捕鱼的结构需要调整一下  这里要干掉否则 隐藏bug\n        if (pb == null) {\n            console.error(`${prefabPath}不存在使用了兼容模式`);\n            pb = await ResMgr.getInstance().loadForm(prefabPath);\n        }\n        if (pb == null) {\n            console.error(`${prefabPath}win节点加载失败`);\n            //如果加载失败了，则需要将节点从\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        let node = instantiate(pb);\n        let com = node.getComponent(UIWindow);\n        if (com == null) {\n            warn(`${prefabPath}win加载没有绑定到UIWindow组件上`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        if (com.modalType.opacity >= ModalOpacity.OpacityZero) {\n            console.log(\"开始获取屏蔽层的东西\");\n            let maskNode = this.getMaskNode();\n            if (maskNode == null) {\n                //有屏蔽层\n                let mask = ResMgr.getInstance().getPrefabByPath(\"Lobby/Prefabs/UIMask\");\n                maskNode = instantiate(mask!);\n            }\n            this.ndWin!.addChild(maskNode);\n            maskNode.setContentSize(new Size(view.getFrameSize().width, view.getFrameSize().height));\n            this.winMasks[prefabPath] = maskNode;\n        }\n        com.fid = prefabPath;\n        this.ndWin!.addChild(node);\n        this.winArr.push(com);\n        this.allForms[prefabPath] = com;\n        com.onShow(...params);\n        if (com.modalType.opacity >= ModalOpacity.OpacityZero) {\n            let arr: UIBase[] = this.getModelTypeComs();\n            ModalMgr.getInstance().checkModalWinAndPopUp(arr, this.winMasks, true);\n        }\n        delete this.loadingForms[prefabPath];\n        com.showEffect();\n\n        return com;\n    }\n\n    /**\n     * 对弹出来的popup进行重新排序\n     * @param popup \n     */\n    public reSortPopup(popup: UIPopup) {\n        if (this.popupsArr.length > 0) {\n            let tIdx = popup.node.getSiblingIndex();\n            let maxIdx = this.popupsArr[this.popupsArr.length - 1].node!.getSiblingIndex();\n            let bigger: boolean = false;\n            for (let k = 0; k < this.popupsArr.length; k++) {\n                if (this.popupsArr[k].fid == popup.fid) {\n                    bigger = true;\n                    continue;\n                }\n                if (bigger == false) {\n                    this.popupsArr[k].node.setSiblingIndex(k);\n                }\n                if (bigger) {\n                    this.popupsArr[k].node.setSiblingIndex(k - 1);\n                }\n            }\n            popup.node.setSiblingIndex(this.popupsArr.length - 1);\n        }\n    }\n\n    //动态计算需要遮罩的win和popups\n    //对于popup来说，层级越高，越在上\n    public getModelTypeComs(): UIBase[] {\n        let arr: UIBase[] = [];\n        for (let k = 0; k < this.popupsArr.length; k++) {\n            arr.push(this.popupsArr[k]);\n        }\n        for (let k = 0; k < this.winArr.length; k++) {\n            arr.push(this.winArr[k]);\n        }\n        return arr;\n    }\n    //打开wait界面\n    public async openWait(prefabPath: string): Promise<UIWindow | null> {\n        if (prefabPath == null || prefabPath == undefined || prefabPath.length <= 0) {\n            warn(`${prefabPath}win节点不存在`);\n            return null;\n        }\n        if (this.checkFormShowing(prefabPath)) {\n            warn(`${prefabPath}Win节点正在显示中`);\n            return null;\n        }\n        if (this.checkFormLoading(prefabPath)) {\n            warn(`${prefabPath}win节点正在加载中...`);\n            return null;\n        }\n        this.loadingForms[prefabPath] = true;\n\n        let node = this.getWaitNode();\n        if (node == null) {\n            let pb = ResMgr.getInstance().getPrefabByPath(prefabPath);\n            //兼容一下，暂时这么写。捕鱼的结构需要调整一下  这里要干掉否则 隐藏bug\n            if (pb == null) {\n                console.error(`${prefabPath}不存在使用了兼容模式`);\n                pb = await ResMgr.getInstance().loadForm(prefabPath);\n            }\n            if (pb == null) {\n                console.error(`${prefabPath}win节点加载失败`);\n                delete this.loadingForms[prefabPath];\n                return null;\n            }\n            node = instantiate(pb);\n        }\n\n        let com = node.getComponent(UIWindow);\n        if (com == null) {\n            warn(`${prefabPath}win加载没有绑定到UIWindow组件上`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        if (com.modalType.opacity >= ModalOpacity.OpacityZero) {\n            console.log(\"开始获取屏蔽层的东西\");\n            let maskNode = this.getMaskNode();\n            if (maskNode == null) {\n                //有屏蔽层\n                let mask = ResMgr.getInstance().getPrefabByPath(\"Lobby/Prefabs/UIMask\");\n                maskNode = instantiate(mask!);\n            }\n            if (maskNode == null) {\n                console.error(`maskNode为空了=====xxxx`);\n\n            }\n            this.ndWin!.addChild(maskNode);\n            maskNode.setContentSize(new Size(view.getFrameSize().width, view.getFrameSize().height))\n            // maskNode.getComponent(UITransform)!.contentSize = new Size(view.getFrameSize().width, view.getFrameSize().height);\n            this.winMasks[prefabPath] = maskNode;\n        }\n        com.fid = prefabPath;\n        this.ndWin!.addChild(node);\n        this.winArr.push(com);\n        this.allForms[prefabPath] = com;\n        com.onShow();\n        let arr: UIBase[] = this.getModelTypeComs();\n        ModalMgr.getInstance().checkModalWinAndPopUp(arr, this.winMasks, true);\n        delete this.loadingForms[prefabPath];\n        await com.showEffect();\n        return com;\n    }\n    private getWaitNode(): Node | null {\n        if (this.waitNodePool.size() > 0) {\n            return this.waitNodePool.get();\n        }\n        return null;\n    }\n\n    //关闭waiting节点\n    public async closeWaiting(prefabPath: string) {\n        let com = this.allForms[prefabPath];\n        if (!com) {\n            console.log(\"closeForm中的com不存在\");\n            return false;\n        }\n        console.log(\"关闭waiting ==========\");\n        let tIdx: number = -1;\n        if (this.winArr.length > 0) {\n            for (let k = 0; k < this.winArr.length; k++) {\n                if (this.winArr[k].fid == prefabPath) {\n                    tIdx = k;\n                    com = this.winArr[k];\n                    break;\n                }\n            }\n        }\n        if (tIdx >= 0 && tIdx < this.winArr.length) {\n            this.winArr.splice(tIdx, 1);\n            com!.onHide();\n            let maskPath = com!.fid;\n            let maskNode = this.winMasks[maskPath];\n            if (maskNode) {\n                let t = com!.getHideEffectTime();\n                //消失要有消失动画\n                Tween.stopAllByTarget(maskNode);\n                tween(maskNode)\n                    .to(t, { opacity: 0 }, { easing: 'linear' })\n                    // 当前面的动作都执行完毕后才会调用这个回调函数\n                    .call(() => {\n                        if (!this.reBackMaskNode(maskNode)) {\n                            maskNode.destroy();\n                            ResMgr.getInstance().destoryForm(\"Lobby/Prefabs/UIMask\");\n                        }\n                    })\n                    .start()\n            }\n            delete this.winMasks[maskPath];\n            let arr: UIBase[] = this.getModelTypeComs();\n            ModalMgr.getInstance().checkModalWinAndPopUp(arr, this.winMasks, false);\n            await com!.hideEffect();\n            this.reBackWaitNode(com.node);\n            ResMgr.getInstance().destoryForm(prefabPath);\n        }\n        delete this.allForms[prefabPath];\n    }\n    private reBackWaitNode(node: Node) {\n        this.waitNodePool.put(node);\n    }\n\n    /**\n     * 关闭一个UIForm\n     * @prefabPath\n     */\n    public async closeForm(prefabPath: string): Promise<boolean> {\n        console.log(\"closeForm关闭\", prefabPath);\n        if (!prefabPath || prefabPath.length <= 0) {\n            warn(`${prefabPath}`, \"参数错误\");\n            return false;\n        }\n        let path = prefabPath.split(\"_\")[0];\n        let com = this.allForms[prefabPath];\n        if (!com && path.length == prefabPath.length) {\n            console.log(\"closeForm中的com不存在\");\n            return false;\n        }\n        // if(com == null && path.length != prefabPath.length){\n        //     for(let i = 0;i<this.bubbleMap.get(path).length;i++){\n        //         if(this.bubbleMap.get(path)[i].fid == prefabPath){\n        //             com = this.bubbleMap.get(path)[i];\n        //             break;\n        //         }\n        //     }\n        // }\n        if (!com) {\n            console.log(\"closeForm中的com不存在\");\n            return false;\n        }\n        switch (com.formType) {\n            case FormType.FormType_Screen:\n                await this.exitToScreen(prefabPath);\n                break;\n            case FormType.FormType_Fixed:\n                // await this.exitToFixed(prefabPath);\n                break;\n            case FormType.FormType_Popup:\n                // await this.exitToPopup(prefabPath);\n                break;\n            case FormType.FormType_Float:\n                // await this.exitToFloat(prefabPath);\n                break;\n            case FormType.FormType_Win:\n                await this.exitToWin(prefabPath);\n                break;\n            case FormType.FormType_Loading:\n                // await this.exitToLoading(prefabPath);\n                break;\n            case FormType.FormType_Bubble:\n                // await this.exitToBubble(prefabPath);\n                break;\n        }\n        return true;\n    }\n\n    /**\n     * screen退出\n     * @param prefabPath \n     * @returns \n     */\n    private async exitToScreen(prefabPath: string) {\n        console.log(`${prefabPath}exitToScreen`);\n        let com = this.allForms[prefabPath];\n        if (!com) {\n            return false;\n        }\n        //screen的退出必须是按照栈退出\n        let tcom = this.screensStack.pop();\n        if (tcom != com) {\n            warn(`${prefabPath}screen没有按顺序退出`);\n            return;\n        }\n        let nextCom = this.screensStack.getTopElement();\n        if (nextCom != null) {\n            nextCom.node.active = true;\n            //界面重新被激活\n            nextCom.reShow();\n        }\n        com.onHide();\n        //如果不是独占 （这里其实不用判断是否是独占，只要判定还有screen就显示出来就可以了）\n        await com.hideEffect();\n        //节点需要从父节点移除\n        com.node.destroy();\n        //com.node.removeFromParent();\n        ResMgr.getInstance().destoryForm(prefabPath);\n        delete this.allForms[prefabPath];\n        console.log(prefabPath, \"exittoscreen 成功\");\n        let maskNode = this.screenMasks[prefabPath];\n        if (maskNode != null && maskNode != undefined) {\n            if (!this.reBackMaskNode(maskNode)) {\n                maskNode.destroy();\n                ResMgr.getInstance().destoryForm(\"Lobby/Prefabs/UIMask\");\n            }\n            delete this.screenMasks[prefabPath];\n        }\n    }\n\n    /**\n     * @description:退出窗口 \n     * @param {string} prefabPath\n     */\n    private async exitToWin(prefabPath: string) {\n        let com: UIWindow | null = null;\n        let tIdx: number = -1;\n        if (this.winArr.length > 0) {\n            for (let k = 0; k < this.winArr.length; k++) {\n                if (this.winArr[k].fid == prefabPath) {\n                    tIdx = k;\n                    com = this.winArr[k];\n                    break;\n                }\n            }\n        }\n        if (tIdx >= 0 && tIdx < this.winArr.length) {\n            this.winArr.splice(tIdx, 1);\n            com!.onHide();\n            let maskPath = com!.fid;\n            let maskNode = this.winMasks[maskPath];\n            if (maskNode) {\n                let t = com!.getHideEffectTime();\n                //消失要有消失动画\n                Tween.stopAllByTarget(maskNode);\n                // tween<UIOpacity>(maskNode.getComponent(UIOpacity)!).to(t, { opacity: 0 }, { easing: \"linear\" }).call(() => {\n                //     //maskNode.removeFromParent();\n                //     if (!this.reBackMaskNode(maskNode)) {\n                //         maskNode.destroy();\n                //         ResMgr.getInstance().destoryForm(\"Lobby/Prefabs/UIMask\");\n                //     }\n                // }).start();\n                tween(maskNode)\n                    .to(t, { opacity: 0 }, { easing: 'linear' })\n                    // 当前面的动作都执行完毕后才会调用这个回调函数\n                    .call(() => {\n                        if (!this.reBackMaskNode(maskNode)) {\n                            maskNode.destroy();\n                            ResMgr.getInstance().destoryForm(\"Lobby/Prefabs/UIMask\");\n                        }\n                    })\n                    .start()\n            }\n            delete this.winMasks[maskPath];\n            let arr: UIBase[] = this.getModelTypeComs();\n            ModalMgr.getInstance().checkModalWinAndPopUp(arr, this.winMasks, false);\n            await com!.hideEffect();\n            com!.node.destroy();\n            ResMgr.getInstance().destoryForm(prefabPath);\n        }\n        delete this.allForms[prefabPath];\n    }\n    private reBackMaskNode(node: Node): boolean {\n        if (this.maskNodePool.size() >= 10) {\n            return false;\n        }\n        this.maskNodePool.put(node);\n        return true;\n    }\n\n    public static destory() {\n        this.instance = null!;\n        director.off(\"winsizechanged\")\n    }\n}"]}