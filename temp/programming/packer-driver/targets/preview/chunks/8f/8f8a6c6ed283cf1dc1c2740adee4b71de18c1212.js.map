{"version":3,"sources":["file:///Users/super_javan/cocoscreator/littleBeastFight3.6/assets/Script/UIFrame/UIMgr.ts"],"names":["UIManager","director","instantiate","js","NodePool","Size","Tween","tween","view","warn","Widget","ResMgr","PriorityStake","FormType","ModalOpacity","ModalMgr","UIScreen","UIWindow","ndScreen","ndWin","allForms","createMap","screensStack","loadingForms","winArr","winMasks","screenMasks","waitNodePool","maskNodePool","getInstance","instance","on","onWinSizeChged","uiscreens","getElements","k","length","console","log","node","getComponent","updateAlignment","init","ndLoading","ndBlock","checkFormShowing","prefabPath","com","active","checkFormLoading","getMaskNode","size","maskNode","get","openScreen","undefined","pb","getPrefabByPath","error","loadForm","isOnleyEngross","getSize","getTopElement","closeSelf","isEngross","is3d","mask","addChild","setContentSize","screen","width","height","key","fid","params","onShow","showEffect","all","push","openWin","modalType","opacity","OpacityZero","getFrameSize","arr","getModelTypeComs","checkModalWinAndPopUp","closeForm","path","split","formType","FormType_Screen","exitToScreen","FormType_Fixed","FormType_Popup","FormType_Float","FormType_Win","exitToWin","FormType_Loading","FormType_Bubble","tcom","pop","nextCom","reShow","onHide","hideEffect","destroy","destoryForm","reBackMaskNode","tIdx","splice","maskPath","t","getHideEffectTime","stopAllByTarget","to","easing","call","start","put","destory","off"],"mappings":"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","sourcesContent":["import { director, instantiate, js, NodePool, Size, Tween, tween, view, warn, Widget } from \"cc\";\nimport { ResMgr } from \"../BaseManager/ResMgr\";\nimport { PriorityStake } from \"../utils/PriorityStack\";\nimport { FormType, ModalOpacity } from \"./config/SysDefine\";\nimport { ModalMgr } from \"./ModalMgr\";\nimport { UIBase } from \"./UIBase\";\nimport { UILoading, UIScreen, UIWindow } from \"./UIFrom\";\n\nexport class UIManager {\n    //全屏显示的ui挂载节点\n    private ndScreen: Node = null;\n    //能够拦截float的win\n    private ndWin: Node = null;\n\n    //所有显示的窗体\n    private allForms: { [key: string]: UIBase } = js.createMap();\n    //存储screen\n    private screensStack: PriorityStake<UIScreen> = new PriorityStake<UIScreen>();\n    private loadingForms: { [key: string]: boolean } = js.createMap();\n    private winArr: UIWindow[] = [];\n\n    //win类型的masks\n    private winMasks: { [key: string]: Node } = js.createMap();\n    //screen类型的masks\n    private screenMasks: { [key: string]: Node } = js.createMap();\n\n\n    private static instance: UIManager;\n    public static getInstance(): UIManager {\n        if (this.instance == null) {\n            this.instance = new UIManager();\n            director.on(\"winsizechanged\", this.instance.onWinSizeChged, this.instance);\n        }\n        return this.instance;\n    }\n\n    onWinSizeChged() {\n\n        let uiscreens = this.screensStack.getElements();\n        for (let k = 0; k < uiscreens.length; k++) {\n            console.log(\"窗口变化，要重新刷新一下======\");\n            uiscreens[k].node.getComponent(Widget)!.updateAlignment();\n        }\n    }\n\n    //初始化\n    public init(ndScreen: Node,\n        ndWin: Node,\n        ndLoading: Node,\n        ndBlock: Node): void {\n        this.ndScreen = ndScreen;\n        this.ndWin = ndWin;\n    }\n\n    //判断一个界面是否正在显示\n    public checkFormShowing(prefabPath: string): boolean {\n        let com = this.allForms[prefabPath];\n        if (!com) {\n            return false;\n        }\n        return com.node.active;\n    }\n    public checkFormLoading(prefabPath: string) {\n        let com = this.loadingForms[prefabPath];\n        return !!com;\n    }\n\n    private waitNodePool: NodePool = new NodePool();\n    private maskNodePool: NodePool = new NodePool();\n    private getMaskNode(): Node | null {\n        if (this.maskNodePool.size() > 0) {\n            let maskNode = this.maskNodePool.get();\n            return maskNode\n        }\n        return null;\n    }\n\n    //打开一个screen\n    public async openScreen(prefabPath: string, ...params: any): Promise<UIScreen | null> {\n        console.log(`打开openScene--${prefabPath}`);\n        if (prefabPath == null || prefabPath == undefined || prefabPath.length <= 0) {\n            warn(`${prefabPath}，参数错误`);\n            return null;\n        }\n        //当前窗体正在显示\n        if (this.checkFormShowing(prefabPath)) {\n            warn(`${prefabPath}窗体正在显示中`);\n            return null;\n        }\n        if (this.checkFormLoading(prefabPath)) {\n            warn(`${prefabPath}正在加载中`);\n            return null;\n        }\n        this.loadingForms[prefabPath] = true;\n        let pb = ResMgr.getInstance().getPrefabByPath(prefabPath);\n\n        if (pb == null) {\n            console.error(\"兼容模式 需要 去健在窗体\")\n            pb = await ResMgr.getInstance().loadForm(prefabPath)!;\n        }\n\n        if (pb == null) {\n            warn(`${prefabPath}窗体加载错误!`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        let node = instantiate(pb!);\n        let com = node.getComponent(UIScreen);\n        if (com == null) {\n            warn(`${prefabPath}没有绑定UIScreen组件`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n\n        if (com.isOnleyEngross) {\n            //关闭掉所有的screen\n            console.log(\"关闭所有的screeen\", this.screensStack.getSize(), \"==========\");\n            while (this.screensStack.getSize() > 0) {\n                await this.screensStack.getTopElement()!.closeSelf();\n            }\n        } else if (com.isEngross) {\n            while (this.screensStack.getSize() > 0) {\n                await this.screensStack.getTopElement()!.closeSelf();\n            }\n        }\n\n        //给screen增加屏蔽层\n        if (!com.is3d) {\n            console.log(\"需要加屏蔽层========\");\n            let maskNode = this.getMaskNode();\n            if (maskNode == null) {\n                let mask = ResMgr.getInstance().getPrefabByPath(\"Lobby/Prefabs/UIMask\");\n                if (mask != null) {\n                    maskNode = instantiate(mask!);\n                }\n            }\n            if (maskNode != null) {\n                //在首次加载的时候会有问题。这个地方需要优化一下\n                this.ndScreen!.addChild(maskNode!);\n                maskNode!.setContentSize(new Size(screen.width, screen.height));\n                this.screenMasks[prefabPath] = maskNode!;\n            }\n        } else {\n            console.log(\"当前为3D场景不需要加屏蔽层\");\n            for (let key in this.screenMasks) {\n                this.screenMasks[key].active = false;\n            }\n        }\n\n        this.allForms[prefabPath] = com;\n        com.fid = prefabPath;\n        this.ndScreen!.addChild(node);\n\n        com.onShow(...params);\n        await com.showEffect();\n        if (!com.isEngross) {\n            //不独占 将其他screen active 设置为false\n            let all = this.screensStack.getElements();\n            for (let k = 0; k < all.length; k++) {\n                all[k].node.active = false;\n            }\n        }\n        //将对象保存到stack中\n        this.screensStack.push(com);\n        console.log('保存场景的堆栈数量 : !!!!!!' + this.screensStack.getSize());\n        delete this.loadingForms[prefabPath]\n        return com\n    }\n\n    //打开一个窗口\n    public async openWin(prefabPath: string, ...params: any): Promise<UIWindow | null> {\n        console.log(`打开openWin--${prefabPath}`);\n        if (prefabPath == null || prefabPath == undefined || prefabPath.length <= 0) {\n            warn(`${prefabPath}Win节点不存在`);\n            return null;\n        }\n        if (this.checkFormShowing(prefabPath)) {\n            warn(`${prefabPath}win节点正在显示中`);\n            return null;\n        }\n        if (this.checkFormLoading(prefabPath)) {\n            warn(`${prefabPath}win节点正在打开...`)\n            return null;\n        }\n        this.loadingForms[prefabPath] = true;\n        let pb = ResMgr.getInstance().getPrefabByPath(prefabPath);\n        //await this.waitFormsecond();\n        //兼容一下，暂时这么写。捕鱼的结构需要调整一下  这里要干掉否则 隐藏bug\n        if (pb == null) {\n            console.error(`${prefabPath}不存在使用了兼容模式`);\n            pb = await ResMgr.getInstance().loadForm(prefabPath);\n        }\n        if (pb == null) {\n            console.error(`${prefabPath}win节点加载失败`);\n            //如果加载失败了，则需要将节点从\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        let node = instantiate(pb);\n        let com = node.getComponent(UIWindow);\n        if (com == null) {\n            warn(`${prefabPath}win加载没有绑定到UIWindow组件上`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        if (com.modalType.opacity >= ModalOpacity.OpacityZero) {\n            console.log(\"开始获取屏蔽层的东西\");\n            let maskNode = this.getMaskNode();\n            if (maskNode == null) {\n                //有屏蔽层\n                let mask = ResMgr.getInstance().getPrefabByPath(\"Lobby/Prefabs/UIMask\");\n                maskNode = instantiate(mask!);\n            }\n            this.ndWin!.addChild(maskNode);\n            maskNode.setContentSize(new Size(view.getFrameSize().width, view.getFrameSize().height));\n            this.winMasks[prefabPath] = maskNode;\n        }\n        com.fid = prefabPath;\n        this.ndWin!.addChild(node);\n        this.winArr.push(com);\n        this.allForms[prefabPath] = com;\n        com.onShow(...params);\n        if (com.modalType.opacity >= ModalOpacity.OpacityZero) {\n            let arr: UIBase[] = this.getModelTypeComs();\n            ModalMgr.getInstance().checkModalWinAndPopUp(arr, this.winMasks, true);\n        }\n        delete this.loadingForms[prefabPath];\n        com.showEffect();\n\n        return com;\n    }\n\n    /**\n     * 关闭一个UIForm\n     * @prefabPath\n     */\n    public async closeForm(prefabPath: string): Promise<boolean> {\n        console.log(\"closeForm关闭\", prefabPath);\n        if (!prefabPath || prefabPath.length <= 0) {\n            warn(`${prefabPath}`, \"参数错误\");\n            return false;\n        }\n        let path = prefabPath.split(\"_\")[0];\n        let com = this.allForms[prefabPath];\n        if (!com && path.length == prefabPath.length) {\n            console.log(\"closeForm中的com不存在\");\n            return false;\n        }\n        // if(com == null && path.length != prefabPath.length){\n        //     for(let i = 0;i<this.bubbleMap.get(path).length;i++){\n        //         if(this.bubbleMap.get(path)[i].fid == prefabPath){\n        //             com = this.bubbleMap.get(path)[i];\n        //             break;\n        //         }\n        //     }\n        // }\n        if (!com) {\n            console.log(\"closeForm中的com不存在\");\n            return false;\n        }\n        switch (com.formType) {\n            case FormType.FormType_Screen:\n                await this.exitToScreen(prefabPath);\n                break;\n            case FormType.FormType_Fixed:\n                // await this.exitToFixed(prefabPath);\n                break;\n            case FormType.FormType_Popup:\n                // await this.exitToPopup(prefabPath);\n                break;\n            case FormType.FormType_Float:\n                // await this.exitToFloat(prefabPath);\n                break;\n            case FormType.FormType_Win:\n                await this.exitToWin(prefabPath);\n                break;\n            case FormType.FormType_Loading:\n                // await this.exitToLoading(prefabPath);\n                break;\n            case FormType.FormType_Bubble:\n                // await this.exitToBubble(prefabPath);\n                break;\n        }\n        return true;\n    }\n\n    /**\n     * screen退出\n     * @param prefabPath \n     * @returns \n     */\n    private async exitToScreen(prefabPath: string) {\n        console.log(`${prefabPath}exitToScreen`);\n        let com = this.allForms[prefabPath];\n        if (!com) {\n            return false;\n        }\n        //screen的退出必须是按照栈退出\n        let tcom = this.screensStack.pop();\n        if (tcom != com) {\n            warn(`${prefabPath}screen没有按顺序退出`);\n            return;\n        }\n        let nextCom = this.screensStack.getTopElement();\n        if (nextCom != null) {\n            nextCom.node.active = true;\n            //界面重新被激活\n            nextCom.reShow();\n        }\n        com.onHide();\n        //如果不是独占 （这里其实不用判断是否是独占，只要判定还有screen就显示出来就可以了）\n        await com.hideEffect();\n        //节点需要从父节点移除\n        com.node.destroy();\n        //com.node.removeFromParent();\n        ResMgr.getInstance().destoryForm(prefabPath);\n        delete this.allForms[prefabPath];\n        console.log(prefabPath, \"exittoscreen 成功\");\n        let maskNode = this.screenMasks[prefabPath];\n        if (maskNode != null && maskNode != undefined) {\n            if (!this.reBackMaskNode(maskNode)) {\n                maskNode.destroy();\n                ResMgr.getInstance().destoryForm(\"Lobby/Prefabs/UIMask\");\n            }\n            delete this.screenMasks[prefabPath];\n        }\n    }\n\n    /**\n     * @description:退出窗口 \n     * @param {string} prefabPath\n     */\n    private async exitToWin(prefabPath: string) {\n        let com: UIWindow | null = null;\n        let tIdx: number = -1;\n        if (this.winArr.length > 0) {\n            for (let k = 0; k < this.winArr.length; k++) {\n                if (this.winArr[k].fid == prefabPath) {\n                    tIdx = k;\n                    com = this.winArr[k];\n                    break;\n                }\n            }\n        }\n        if (tIdx >= 0 && tIdx < this.winArr.length) {\n            this.winArr.splice(tIdx, 1);\n            com!.onHide();\n            let maskPath = com!.fid;\n            let maskNode = this.winMasks[maskPath];\n            if (maskNode) {\n                let t = com!.getHideEffectTime();\n                //消失要有消失动画\n                Tween.stopAllByTarget(maskNode);\n                tween(maskNode)\n                    .to(t, { opacity: 0 }, { easing: 'linear' })\n                    // 当前面的动作都执行完毕后才会调用这个回调函数\n                    .call(() => {\n                        if (!this.reBackMaskNode(maskNode)) {\n                            maskNode.destroy();\n                            ResMgr.getInstance().destoryForm(\"Lobby/Prefabs/UIMask\");\n                        }\n                    })\n                    .start()\n            }\n            delete this.winMasks[maskPath];\n            let arr: UIBase[] = this.getModelTypeComs();\n            ModalMgr.getInstance().checkModalWinAndPopUp(arr, this.winMasks, false);\n            await com!.hideEffect();\n            com!.node.destroy();\n            ResMgr.getInstance().destoryForm(prefabPath);\n        }\n        delete this.allForms[prefabPath];\n    }\n    private reBackMaskNode(node: Node): boolean {\n        if (this.maskNodePool.size() >= 10) {\n            return false;\n        }\n        this.maskNodePool.put(node);\n        return true;\n    }\n\n    public static destory() {\n        this.instance = null!;\n        director.off(\"winsizechanged\")\n    }\n}"]}