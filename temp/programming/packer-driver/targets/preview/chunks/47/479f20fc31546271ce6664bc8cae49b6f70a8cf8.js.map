{"version":3,"sources":["file:///Users/super_javan/cocoscreator/littleBeastFight3.6/assets/Script/UIFrame/UIMgr.ts"],"names":["UIManager","director","instantiate","js","NodePool","Size","Tween","tween","view","warn","Widget","UITransform","UIOpacity","ResMgr","FormType","ModalOpacity","PriorityStake","ModalMgr","UIScreen","UIWindow","ndScreen","ndWin","allForms","createMap","screensStack","loadingForms","winArr","winMasks","screenMasks","waitNodePool","maskNodePool","getInstance","instance","on","onWinSizeChged","uiscreens","getElements","k","length","console","log","node","getComponent","updateAlignment","init","checkFormShowing","prefabPath","com","active","checkFormLoading","getMaskNode","size","get","openScreen","undefined","pb","getPrefabByPath","error","isOnleyEngross","getSize","getTopElement","closeSelf","isEngross","maskNode","mask","addChild","setContentSize","screen","width","height","fid","params","onShow","showEffect","all","push","openWin","loadForm","modalType","opacity","OpacityZero","getFrameSize","arr","getModelTypeComs","checkModalWinAndPopUp","closeForm","path","split","formType","FormType_Screen","exitToScreen","FormType_Fixed","FormType_Popup","FormType_Float","FormType_Win","exitToWin","FormType_Loading","FormType_Bubble","tcom","pop","nextCom","reShow","onHide","hideEffect","destroy","destoryForm","reBackMaskNode","tIdx","splice","maskPath","t","getHideEffectTime","stopAllByTarget","to","easing","call","start","put","destory","off"],"mappings":"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","sourcesContent":["import { director, instantiate, js, NodePool, Node, Size, Tween, tween, view, warn, Widget, UITransform, UIOpacity } from \"cc\";\nimport { ResMgr } from \"../Base/ResMgr\";\nimport { FormType, ModalOpacity } from \"../Config/SysDefine\";\nimport { PriorityStake } from \"../Utils/PriorityStake\";\nimport { ModalMgr } from \"./ModalMgr\";\n\n// import { ModalMgr } from \"./ModalMgr\";\nimport { UIBase } from \"./UIBase\";\nimport { UILoading, UIScreen, UIWindow } from \"./UIFrom\";\n\nexport class UIManager {\n    //全屏显示的ui挂载节点\n    private ndScreen: Node | null = null;\n    //能够拦截float的win\n    private ndWin: Node | null = null;\n\n    //所有显示的窗体\n    private allForms: { [key: string]: UIBase } = js.createMap();\n    //存储screen\n    private screensStack: PriorityStake<UIScreen> = new PriorityStake<UIScreen>();\n    private loadingForms: { [key: string]: boolean } = js.createMap();\n    private winArr: UIWindow[] = [];\n\n    //win类型的masks\n    private winMasks: { [key: string]: Node } = js.createMap();\n    //screen类型的masks\n    private screenMasks: { [key: string]: Node } = js.createMap();\n\n\n    private static instance: UIManager;\n    public static getInstance(): UIManager {\n        if (this.instance == null) {\n            this.instance = new UIManager();\n            director.on(\"winsizechanged\", this.instance.onWinSizeChged, this.instance);\n        }\n        return this.instance;\n    }\n\n    onWinSizeChged() {\n\n        let uiscreens = this.screensStack.getElements();\n        for (let k = 0; k < uiscreens.length; k++) {\n            console.log(\"窗口变化，要重新刷新一下======\");\n            uiscreens[k].node.getComponent(Widget)!.updateAlignment();\n        }\n    }\n\n    //初始化\n    public init(ndScreen: Node,\n        ndWin: Node): void {\n        this.ndScreen = ndScreen;\n        this.ndWin = ndWin;\n    }\n\n    //判断一个界面是否正在显示\n    public checkFormShowing(prefabPath: string): boolean {\n        let com = this.allForms[prefabPath];\n        if (!com) {\n            return false;\n        }\n        return com.node.active;\n    }\n    public checkFormLoading(prefabPath: string) {\n        let com = this.loadingForms[prefabPath];\n        return !!com;\n    }\n\n    private waitNodePool: NodePool = new NodePool();\n    private maskNodePool: NodePool = new NodePool();\n    private getMaskNode() {\n        if (this.maskNodePool.size() > 0) {\n            return this.maskNodePool.get();\n        }\n        return null\n    }\n\n    //打开一个screen\n    public async openScreen(prefabPath: string, ...params: any): Promise<UIScreen | null> {\n        console.log(`打开openScene--${prefabPath}`);\n        if (prefabPath == null || prefabPath == undefined || prefabPath.length <= 0) {\n            warn(`${prefabPath}，参数错误`);\n            return null;\n        }\n        //当前窗体正在显示\n        if (this.checkFormShowing(prefabPath)) {\n            warn(`${prefabPath}窗体正在显示中`);\n            return null;\n        }\n        if (this.checkFormLoading(prefabPath)) {\n            warn(`${prefabPath}正在加载中`);\n            return null;\n        }\n        this.loadingForms[prefabPath] = true;\n        let pb = ResMgr.getInstance().getPrefabByPath(prefabPath);\n\n        if (pb == null) {\n            console.error(\"兼容模式 需要 去健在窗体\")\n            // pb = await ResMgr.getInstance().loadForm(prefabPath)!;\n        }\n\n        if (pb == null) {\n            warn(`${prefabPath}窗体加载错误!`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        let node = instantiate(pb!);\n        let com = node.getComponent(UIScreen);\n        if (com == null) {\n            warn(`${prefabPath}没有绑定UIScreen组件`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n\n        if (com.isOnleyEngross) {\n            //关闭掉所有的screen\n            console.log(\"关闭所有的screeen\", this.screensStack.getSize(), \"==========\");\n            while (this.screensStack.getSize() > 0) {\n                await this.screensStack.getTopElement()!.closeSelf();\n            }\n        } else if (com.isEngross) {\n            while (this.screensStack.getSize() > 0) {\n                await this.screensStack.getTopElement()!.closeSelf();\n            }\n        }\n\n        //给screen增加屏蔽层\n        console.log(\"需要加屏蔽层========\");\n        let maskNode = this.getMaskNode();\n        if (maskNode == null) {\n            let mask = ResMgr.getInstance().getPrefabByPath(\"Lobby/Prefabs/UIMask\");\n            if (mask != null) {\n                maskNode = instantiate(mask!);\n            }\n        }\n        if (maskNode != null) {\n            //在首次加载的时候会有问题。这个地方需要优化一下\n            this.ndScreen!.addChild(maskNode!);\n            maskNode.getComponent(UITransform).setContentSize(new Size(screen.width, screen.height))\n            this.screenMasks[prefabPath] = maskNode!;\n        }\n\n        this.allForms[prefabPath] = com;\n        com.fid = prefabPath;\n        this.ndScreen!.addChild(node);\n\n        com.onShow(...params);\n        await com.showEffect();\n        if (!com.isEngross) {\n            //不独占 将其他screen active 设置为false\n            let all = this.screensStack.getElements();\n            for (let k = 0; k < all.length; k++) {\n                all[k].node.active = false;\n            }\n        }\n        //将对象保存到stack中\n        this.screensStack.push(com);\n        console.log('保存场景的堆栈数量 : !!!!!!' + this.screensStack.getSize());\n        delete this.loadingForms[prefabPath]\n        return com\n    }\n\n    //打开一个窗口\n    public async openWin(prefabPath: string, ...params: any): Promise<UIWindow | null> {\n        console.log(`打开openWin--${prefabPath}`);\n        if (prefabPath == null || prefabPath == undefined || prefabPath.length <= 0) {\n            warn(`${prefabPath}Win节点不存在`);\n            return null;\n        }\n        if (this.checkFormShowing(prefabPath)) {\n            warn(`${prefabPath}win节点正在显示中`);\n            return null;\n        }\n        if (this.checkFormLoading(prefabPath)) {\n            warn(`${prefabPath}win节点正在打开...`)\n            return null;\n        }\n        this.loadingForms[prefabPath] = true;\n        let pb = ResMgr.getInstance().getPrefabByPath(prefabPath);\n        //await this.waitFormsecond();\n        //兼容一下，暂时这么写。捕鱼的结构需要调整一下  这里要干掉否则 隐藏bug\n        if (pb == null) {\n            console.error(`${prefabPath}不存在使用了兼容模式`);\n            pb = await ResMgr.getInstance().loadForm(prefabPath);\n        }\n        if (pb == null) {\n            console.error(`${prefabPath}win节点加载失败`);\n            //如果加载失败了，则需要将节点从\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        let node = instantiate(pb);\n        let com = node.getComponent(UIWindow);\n        if (com == null) {\n            warn(`${prefabPath}win加载没有绑定到UIWindow组件上`);\n            delete this.loadingForms[prefabPath];\n            return null;\n        }\n        if (com.modalType.opacity >= ModalOpacity.OpacityZero) {\n            console.log(\"开始获取屏蔽层的东西\");\n            let maskNode = this.getMaskNode();\n            if (maskNode == null) {\n                //有屏蔽层\n                let mask = ResMgr.getInstance().getPrefabByPath(\"Lobby/Prefabs/UIMask\");\n                maskNode = instantiate(mask!);\n            }\n            this.ndWin!.addChild(maskNode);\n            maskNode.getComponent(UITransform).setContentSize(new Size(view.getFrameSize().width, view.getFrameSize().height));\n            this.winMasks[prefabPath] = maskNode;\n        }\n        com.fid = prefabPath;\n        this.ndWin!.addChild(node);\n        this.winArr.push(com);\n        this.allForms[prefabPath] = com;\n        com.onShow(...params);\n        if (com.modalType.opacity >= ModalOpacity.OpacityZero) {\n            let arr: UIBase[] = this.getModelTypeComs();\n            ModalMgr.getInstance().checkModalWinAndPopUp(arr, this.winMasks, true);\n        }\n        delete this.loadingForms[prefabPath];\n        com.showEffect();\n\n        return com;\n    }\n\n    //动态计算需要遮罩的win和popups\n    //对于popup来说，层级越高，越在上\n    public getModelTypeComs(): UIBase[] {\n        let arr: UIBase[] = [];\n        for (let k = 0; k < this.winArr.length; k++) {\n            arr.push(this.winArr[k]);\n        }\n        return arr;\n    }\n\n    /**\n     * 关闭一个UIForm\n     * @prefabPath\n     */\n    public async closeForm(prefabPath: string): Promise<boolean> {\n        console.log(\"closeForm关闭\", prefabPath);\n        if (!prefabPath || prefabPath.length <= 0) {\n            warn(`${prefabPath}`, \"参数错误\");\n            return false;\n        }\n        let path = prefabPath.split(\"_\")[0];\n        let com = this.allForms[prefabPath];\n        if (!com && path.length == prefabPath.length) {\n            console.log(\"closeForm中的com不存在\");\n            return false;\n        }\n        // if(com == null && path.length != prefabPath.length){\n        //     for(let i = 0;i<this.bubbleMap.get(path).length;i++){\n        //         if(this.bubbleMap.get(path)[i].fid == prefabPath){\n        //             com = this.bubbleMap.get(path)[i];\n        //             break;\n        //         }\n        //     }\n        // }\n        if (!com) {\n            console.log(\"closeForm中的com不存在\");\n            return false;\n        }\n        switch (com.formType) {\n            case FormType.FormType_Screen:\n                await this.exitToScreen(prefabPath);\n                break;\n            case FormType.FormType_Fixed:\n                // await this.exitToFixed(prefabPath);\n                break;\n            case FormType.FormType_Popup:\n                // await this.exitToPopup(prefabPath);\n                break;\n            case FormType.FormType_Float:\n                // await this.exitToFloat(prefabPath);\n                break;\n            case FormType.FormType_Win:\n                await this.exitToWin(prefabPath);\n                break;\n            case FormType.FormType_Loading:\n                // await this.exitToLoading(prefabPath);\n                break;\n            case FormType.FormType_Bubble:\n                // await this.exitToBubble(prefabPath);\n                break;\n        }\n        return true;\n    }\n\n    /**\n     * screen退出\n     * @param prefabPath \n     * @returns \n     */\n    private async exitToScreen(prefabPath: string) {\n        console.log(`${prefabPath}exitToScreen`);\n        let com = this.allForms[prefabPath];\n        if (!com) {\n            return false;\n        }\n        //screen的退出必须是按照栈退出\n        let tcom = this.screensStack.pop();\n        if (tcom != com) {\n            warn(`${prefabPath}screen没有按顺序退出`);\n            return;\n        }\n        let nextCom = this.screensStack.getTopElement();\n        if (nextCom != null) {\n            nextCom.node.active = true;\n            //界面重新被激活\n            nextCom.reShow();\n        }\n        com.onHide();\n        //如果不是独占 （这里其实不用判断是否是独占，只要判定还有screen就显示出来就可以了）\n        await com.hideEffect();\n        //节点需要从父节点移除\n        com.node.destroy();\n        //com.node.removeFromParent();\n        ResMgr.getInstance().destoryForm(prefabPath);\n        delete this.allForms[prefabPath];\n        console.log(prefabPath, \"exittoscreen 成功\");\n        let maskNode = this.screenMasks[prefabPath];\n        if (maskNode != null && maskNode != undefined) {\n            if (!this.reBackMaskNode(maskNode)) {\n                maskNode.destroy();\n                ResMgr.getInstance().destoryForm(\"Lobby/Prefabs/UIMask\");\n            }\n            delete this.screenMasks[prefabPath];\n        }\n    }\n\n    /**\n     * @description:退出窗口 \n     * @param {string} prefabPath\n     */\n    private async exitToWin(prefabPath: string) {\n        let com: UIWindow | null = null;\n        let tIdx: number = -1;\n        if (this.winArr.length > 0) {\n            for (let k = 0; k < this.winArr.length; k++) {\n                if (this.winArr[k].fid == prefabPath) {\n                    tIdx = k;\n                    com = this.winArr[k];\n                    break;\n                }\n            }\n        }\n        if (tIdx >= 0 && tIdx < this.winArr.length) {\n            this.winArr.splice(tIdx, 1);\n            com!.onHide();\n            let maskPath = com!.fid;\n            let maskNode = this.winMasks[maskPath];\n            if (maskNode) {\n                let t = com!.getHideEffectTime();\n                //消失要有消失动画\n                Tween.stopAllByTarget(maskNode);\n                let opacity = maskNode.getComponent(UIOpacity).opacity\n                tween<UIOpacity>(maskNode.getComponent(UIOpacity))\n                    .to(t, { opacity: 0 }, { easing: 'linear' })\n                    // 当前面的动作都执行完毕后才会调用这个回调函数\n                    .call(() => {\n                        if (!this.reBackMaskNode(maskNode)) {\n                            maskNode.destroy();\n                            ResMgr.getInstance().destoryForm(\"Lobby/Prefabs/UIMask\");\n                        }\n                    })\n                    .start()\n            }\n            delete this.winMasks[maskPath];\n            let arr: UIBase[] = this.getModelTypeComs();\n            ModalMgr.getInstance().checkModalWinAndPopUp(arr, this.winMasks, false);\n            await com!.hideEffect();\n            com!.node.destroy();\n            ResMgr.getInstance().destoryForm(prefabPath);\n        }\n        delete this.allForms[prefabPath];\n    }\n    private reBackMaskNode(node: Node): boolean {\n        if (this.maskNodePool.size() >= 10) {\n            return false;\n        }\n        this.maskNodePool.put(node);\n        return true;\n    }\n\n    public static destory() {\n        this.instance = null!;\n        director.off(\"winsizechanged\")\n    }\n}"]}